/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2024 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Pe=require("react"),S=require("@progress/kendo-draggable-common"),i=require("../noop.js"),ve=require("./useInheritedState.js"),D=require("../drag-n-drop/context/index.js"),xe=require("./use-isomorphic-layout-effect.js");function Ie(o){const m=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const d in o)if(d!=="default"){const h=Object.getOwnPropertyDescriptor(o,d);Object.defineProperty(m,d,h.get?h:{enumerable:!0,get:()=>o[d]})}}return m.default=o,Object.freeze(m)}const t=Ie(Pe),Me=2e3;function Te(o,m,d={}){const{onPress:h=i.noop,onRelease:N=i.noop,onDragStart:W=i.noop,onDrag:F=i.noop,onDragEnd:G=i.noop}=m,{hint:a=null,mouseOnly:O=!1,autoScroll:s=!0,scrollContainer:u=null}=d,[f,be]=t.useState(!1),[v,Ee]=t.useState(!1),[L]=ve.useInheritedState(D.DropContext),[R,b]=ve.useInheritedState(D.DragContext),[J]=t.useContext(D.DropsContext),[K,Q,X]=t.useContext(D.DragsContext),E=t.useRef({x:0,y:0}),w=t.useRef(),P=t.useRef(!1),Y=t.useRef(),C=t.useRef(null),x=t.useRef(!1),Z=t.useRef({x:0,y:0}),$=t.useRef({x:0,y:0}),k=t.useRef({x:0,y:0}),ee=t.useRef({x:0,y:0}),te=t.useRef({x:0,y:0}),ne=t.useRef({x:0,y:0}),ke=!!(typeof window!="undefined"&&window.PointerEvent),re=!O&&ke,l=t.useCallback(()=>o.current&&o.current.element?o.current.element:o.current,[o]),ye=t.useCallback(()=>a&&a.current&&a.current.element?a.current.element:a?a.current:null,[a]),oe=t.useCallback(()=>u&&u.current&&u.current.element?u.current.element:u?u.current:null,[u]),se=t.useCallback(()=>typeof s=="object"&&s.boundaryElementRef&&s.boundaryElementRef.current&&s.boundaryElementRef.current.element?s.boundaryElementRef.current.element:typeof s=="object"&&s.boundaryElementRef&&s.boundaryElementRef.current?s.boundaryElementRef.current:null,[s]),p=t.useRef(null);t.useImperativeHandle(p,()=>({element:l(),hint:ye(),onPress:Se,onDragStart:Oe,onDrag:Le,onDragEnd:Re,onRelease:De,data:o.current}));const y=t.useCallback(()=>{const e=l();return e&&e.ownerDocument||document},[l]),g=t.useCallback(()=>{const e=y();return e&&e.defaultView||window},[y]),ce=t.useCallback(()=>({drag:R?R.current:null,drop:L?L.current:null,drags:K.map(e=>e.current),drops:J.map(e=>e.current),pressed:f,ignoreMouse:P.current,scrollOffset:te.current,offset:Z.current,pageOffset:$.current,initialScrollOffset:ne.current,clientOffset:k.current,initialClientOffset:ee.current,velocity:E.current,autoScroll:!!(typeof s=="object"?s.enabled!==!1:s),scrollableParent:se(),autoScrollDirection:typeof s=="object"?s.direction:{horizontal:!0,vertical:!0},isScrolling:v}),[R,L,K,J,f,s,se,v]),le=t.useCallback(e=>{be(e)},[]),ae=t.useCallback(e=>{Ee(e)},[]),ue=t.useCallback(e=>{E.current=e},[]),ie=t.useCallback(e=>{Z.current=e},[]),de=t.useCallback(e=>{k.current=e},[]),fe=t.useCallback(e=>{$.current=e},[]),ge=t.useCallback(e=>{ee.current=e},[]),me=t.useCallback(e=>{te.current=e},[]),he=t.useCallback(e=>{ne.current=e},[]),Se=t.useCallback(e=>{h(e)},[h]),De=t.useCallback(e=>{N(e)},[N]),Oe=t.useCallback(e=>{b(p,{target:o.current,event:e}),W(e)},[b,o,W]),Le=t.useCallback(e=>{F(e)},[F]),Re=t.useCallback(e=>{x.current||(b(null,{target:o.current,event:e}),G(e))},[G,b,o]),n=t.useCallback(e=>{S.dispatchDragAndDrop(ce(),{event:e,payload:p.current},{onVelocityChange:ue,onOffsetChange:ie,onClientOffsetChange:de,onPageOffsetChange:fe,onInitialClientOffsetChange:ge,onScrollOffsetChange:me,onInitialScrollOffsetChange:he,onIsPressedChange:le,onIsScrollingChange:ae})},[ce,ue,ie,fe,de,ge,he,le,me,ae]),I=t.useCallback(e=>{n(e)},[n]),M=t.useCallback(e=>{n(e)},[n]),T=t.useCallback(e=>{n(e)},[n]),j=t.useCallback(e=>{n(e)},[n]),q=t.useCallback(e=>{n(e)},[n]),A=t.useCallback(e=>{n(e)},[n]),_=t.useCallback(e=>{n(e)},[n]),U=t.useCallback(e=>{e.preventDefault(),n(e)},[n]),V=t.useCallback(e=>{e.preventDefault(),n(e)},[n]),z=t.useCallback(e=>{e.preventDefault(),n(e)},[n]),B=t.useCallback(e=>{if(e.touches.length===0&&e.changedTouches.length===1){const r=g();P.current=!0,Y.current=r.setTimeout(()=>{P.current=!1},Me)}n(e)},[n,g]),H=t.useCallback(e=>{n(e)},[n]),Ce=t.useCallback(()=>{const e=l();if(e){const r=e.style.touchAction;return e.style.touchAction="none",()=>{e.style.touchAction=r}}},[l]),pe=t.useCallback(()=>(Q(p),()=>{X(p)}),[X,Q]),we=()=>{const e=g(),r=l(),c=y();return re?(r&&(C.current=S.getScrollableParent(r),C.current&&C.current.addEventListener("scroll",H,{passive:!0}),r.addEventListener("pointerdown",I,{passive:!0})),f&&(c.addEventListener("pointermove",M),c.addEventListener("pointerup",j,!0),c.addEventListener("contextmenu",U),c.addEventListener("pointercancel",T,{passive:!0}))):(e.addEventListener("touchmove",i.noop,{capture:!1,passive:!1}),r&&(r.addEventListener("mousedown",q,{passive:!0}),O||(r.addEventListener("touchstart",V,{passive:!0}),f&&(r.addEventListener("touchmove",z,{passive:!0}),r.addEventListener("touchend",B,{passive:!0})))),f&&(c.addEventListener("mousemove",A,{passive:!0}),c.addEventListener("mouseup",_,{passive:!0}))),()=>{C.current&&C.current.removeEventListener("scroll",H),r&&(r.removeEventListener("pointerdown",I),r.removeEventListener("mousedown",q),r.removeEventListener("touchstart",V),r.removeEventListener("touchmove",z),r.removeEventListener("touchend",B)),c.removeEventListener("pointermove",M),c.removeEventListener("pointerup",j,!0),c.removeEventListener("contextmenu",U),c.removeEventListener("pointercancel",T),c.removeEventListener("mousemove",A),c.removeEventListener("mouseup",_),e.removeEventListener("touchmove",i.noop),e.clearTimeout(Y.current)}};t.useEffect(()=>{const e=g();if(v){const r=oe()||S.getScrollableParent(document.elementFromPoint(k.current.x,k.current.y));e.clearInterval(w.current),w.current=e.setInterval(()=>{S.autoScroll(r,{x:E.current.x,y:E.current.y})},50)}return()=>{e.clearInterval(w.current)}},[l,oe,g,v]),t.useEffect(Ce,[Ce]),t.useEffect(we,[f,g,l,y,O,re,U,q,A,_,T,I,M,j,B,z,V,H]),t.useEffect(()=>(x.current=!1,()=>{x.current=!0}),[]),xe.useIsomorphicLayoutEffect(pe,[pe])}exports.useDraggable=Te;
